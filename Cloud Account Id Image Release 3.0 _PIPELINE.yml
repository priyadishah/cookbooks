trigger: none

pool:
  vmImage: ubuntu-latest

parameters:
- name: awstemplates_repo
  displayName: 'Source for aws-templates repo'
  type: string
  # default: 'lansa/aws-templates'
  default: nkhl-accolite/aws-templates-nkhl
- name: awstemplates_branch
  displayName: 'Source for aws-templates branch'
  type: string
  default: 'support/scalable'
- name: robe070cookbooks_repo
  displayName: 'Source for cookbooks repo'
  type: string
  # default: 'robe070/cookbooks'
  default: nkhl-accolite/cookbooks
- name: robe070cookbooks_branch
  displayName: 'Source for cookbooks branch'
  type: string
  default: 'debug/paas'
- name: buildcloudaccountidartefacts_branch
  type: string
  default: 'feature/aws-Build-Cloud-Account-Id-Artefacts-3.0'

resources:
  pipelines:
    - pipeline: _BuildCloudAccountIdArtefacts
      # project: Lansa AWS Scalable License Images
      source: Build Cloud Account Id Artefacts
      # branch: ${{ parameters.buildcloudaccountidartefacts_branch }}
    - pipeline: _BuildImageReleaseArtefacts
      # project: Lansa AWS Scalable License Images
      source: Build Image Release Artefacts 2.0
      # branch: ${{ parameters.buildcloudaccountidartefacts_branch }}
  repositories:
    - repository: _LansaAWSTemplates
      # name: ${{ parameters.awstemplates_repo }}
      name: nkhl-accolite/aws-templates-nkhl
      type: github
      ref: ${{ parameters.awstemplates_branch }}
      endpoint: nkhlLANSA
    - repository: _Robe070Cookbooks
      # name: ${{ parameters.robe070cookbooks_repo }}
      name: nkhl-accolite/cookbooks
      type: github
      ref: ${{ parameters.robe070cookbooks_branch }}
      endpoint: nkhlLANSA


stages:
- template: templates/releaseStages_template.yml # Template reference
  parameters:
    stageName: 'v15idold'
    stageDisplayname: 'v15-id-old'
    jobName: 'w19d15idold'
    jobDisplayname: 'w19d-15-id-old'
    _LansaAWSTemplates: $[ resources.repositories._LansaAWSTemplates.name ]

- template: templates/releaseStages_template.yml # Template reference
  parameters:
    stageName: 'v13sp2idnew'
    stageDisplayname: 'v13sp2-id-new'
    jobName: 'w19d15idnew'
    jobDisplayname: 'w19d-15-id-new'

- template: templates/releaseStages_template.yml # Template reference
  parameters:
    stageName: 'v14sp2idnew'
    stageDisplayname: 'v14sp2-id-new'
    jobName: 'w19d15idnew'
    jobDisplayname: 'w19d-15-id-new'